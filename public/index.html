<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />

        <title>Svelte app</title>

        <link rel="icon" type="image/png" href="/favicon.png" />

        <script id="svelte64" type="application/json">
            CihmdW5jdGlvbihsLCByKSB7IGlmICghbCB8fCBsLmdldEVsZW1lbnRCeUlkKCdsaXZlcmVsb2Fkc2NyaXB0JykpIHJldHVybjsgciA9IGwuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IHIuYXN5bmMgPSAxOyByLnNyYyA9ICcvLycgKyAoc2VsZi5sb2NhdGlvbi5ob3N0IHx8ICdsb2NhbGhvc3QnKS5zcGxpdCgnOicpWzBdICsgJzozNTcyOS9saXZlcmVsb2FkLmpzP3NuaXB2ZXI9MSc7IHIuaWQgPSAnbGl2ZXJlbG9hZHNjcmlwdCc7IGwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChyKSB9KShzZWxmLmRvY3VtZW50KTsKdmFyIGFwcCA9IChmdW5jdGlvbiAoKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgZnVuY3Rpb24gbm9vcCgpIHsgfQogICAgZnVuY3Rpb24gYWRkX2xvY2F0aW9uKGVsZW1lbnQsIGZpbGUsIGxpbmUsIGNvbHVtbiwgY2hhcikgewogICAgICAgIGVsZW1lbnQuX19zdmVsdGVfbWV0YSA9IHsKICAgICAgICAgICAgbG9jOiB7IGZpbGUsIGxpbmUsIGNvbHVtbiwgY2hhciB9CiAgICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHJ1bihmbikgewogICAgICAgIHJldHVybiBmbigpOwogICAgfQogICAgZnVuY3Rpb24gYmxhbmtfb2JqZWN0KCkgewogICAgICAgIHJldHVybiBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgZnVuY3Rpb24gcnVuX2FsbChmbnMpIHsKICAgICAgICBmbnMuZm9yRWFjaChydW4pOwogICAgfQogICAgZnVuY3Rpb24gaXNfZnVuY3Rpb24odGhpbmcpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHRoaW5nID09PSAnZnVuY3Rpb24nOwogICAgfQogICAgZnVuY3Rpb24gc2FmZV9ub3RfZXF1YWwoYSwgYikgewogICAgICAgIHJldHVybiBhICE9IGEgPyBiID09IGIgOiBhICE9PSBiIHx8ICgoYSAmJiB0eXBlb2YgYSA9PT0gJ29iamVjdCcpIHx8IHR5cGVvZiBhID09PSAnZnVuY3Rpb24nKTsKICAgIH0KICAgIGZ1bmN0aW9uIGlzX2VtcHR5KG9iaikgewogICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA9PT0gMDsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcGVuZCh0YXJnZXQsIG5vZGUpIHsKICAgICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQobm9kZSk7CiAgICB9CiAgICBmdW5jdGlvbiBpbnNlcnQodGFyZ2V0LCBub2RlLCBhbmNob3IpIHsKICAgICAgICB0YXJnZXQuaW5zZXJ0QmVmb3JlKG5vZGUsIGFuY2hvciB8fCBudWxsKTsKICAgIH0KICAgIGZ1bmN0aW9uIGRldGFjaChub2RlKSB7CiAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOwogICAgfQogICAgZnVuY3Rpb24gZWxlbWVudChuYW1lKSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQobmFtZSk7CiAgICB9CiAgICBmdW5jdGlvbiB0ZXh0KGRhdGEpIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSk7CiAgICB9CiAgICBmdW5jdGlvbiBzcGFjZSgpIHsKICAgICAgICByZXR1cm4gdGV4dCgnICcpOwogICAgfQogICAgZnVuY3Rpb24gbGlzdGVuKG5vZGUsIGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKSB7CiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTsKICAgICAgICByZXR1cm4gKCkgPT4gbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoaWxkcmVuKGVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShlbGVtZW50LmNoaWxkTm9kZXMpOwogICAgfQogICAgLy8gdW5mb3J0dW5hdGVseSB0aGlzIGNhbid0IGJlIGEgY29uc3RhbnQgYXMgdGhhdCB3b3VsZG4ndCBiZSB0cmVlLXNoYWtlYWJsZQogICAgLy8gc28gd2UgY2FjaGUgdGhlIHJlc3VsdCBpbnN0ZWFkCiAgICBsZXQgY3Jvc3NvcmlnaW47CiAgICBmdW5jdGlvbiBpc19jcm9zc29yaWdpbigpIHsKICAgICAgICBpZiAoY3Jvc3NvcmlnaW4gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjcm9zc29yaWdpbiA9IGZhbHNlOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5wYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICB2b2lkIHdpbmRvdy5wYXJlbnQuZG9jdW1lbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjcm9zc29yaWdpbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNyb3Nzb3JpZ2luOwogICAgfQogICAgZnVuY3Rpb24gYWRkX3Jlc2l6ZV9saXN0ZW5lcihub2RlLCBmbikgewogICAgICAgIGNvbnN0IGNvbXB1dGVkX3N0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTsKICAgICAgICBpZiAoY29tcHV0ZWRfc3R5bGUucG9zaXRpb24gPT09ICdzdGF0aWMnKSB7CiAgICAgICAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwogICAgICAgIH0KICAgICAgICBjb25zdCBpZnJhbWUgPSBlbGVtZW50KCdpZnJhbWUnKTsKICAgICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdzdHlsZScsICdkaXNwbGF5OiBibG9jazsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDA7IGxlZnQ6IDA7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7ICcgKwogICAgICAgICAgICAnb3ZlcmZsb3c6IGhpZGRlbjsgYm9yZGVyOiAwOyBvcGFjaXR5OiAwOyBwb2ludGVyLWV2ZW50czogbm9uZTsgei1pbmRleDogLTE7Jyk7CiAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpOwogICAgICAgIGlmcmFtZS50YWJJbmRleCA9IC0xOwogICAgICAgIGNvbnN0IGNyb3Nzb3JpZ2luID0gaXNfY3Jvc3NvcmlnaW4oKTsKICAgICAgICBsZXQgdW5zdWJzY3JpYmU7CiAgICAgICAgaWYgKGNyb3Nzb3JpZ2luKSB7CiAgICAgICAgICAgIGlmcmFtZS5zcmMgPSAiZGF0YTp0ZXh0L2h0bWwsPHNjcmlwdD5vbnJlc2l6ZT1mdW5jdGlvbigpe3BhcmVudC5wb3N0TWVzc2FnZSgwLCcqJyl9PC9zY3JpcHQ+IjsKICAgICAgICAgICAgdW5zdWJzY3JpYmUgPSBsaXN0ZW4od2luZG93LCAnbWVzc2FnZScsIChldmVudCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnNvdXJjZSA9PT0gaWZyYW1lLmNvbnRlbnRXaW5kb3cpCiAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZnJhbWUuc3JjID0gJ2Fib3V0OmJsYW5rJzsKICAgICAgICAgICAgaWZyYW1lLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlID0gbGlzdGVuKGlmcmFtZS5jb250ZW50V2luZG93LCAncmVzaXplJywgZm4pOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBhcHBlbmQobm9kZSwgaWZyYW1lKTsKICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICBpZiAoY3Jvc3NvcmlnaW4pIHsKICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodW5zdWJzY3JpYmUgJiYgaWZyYW1lLmNvbnRlbnRXaW5kb3cpIHsKICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGV0YWNoKGlmcmFtZSk7CiAgICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGN1c3RvbV9ldmVudCh0eXBlLCBkZXRhaWwsIHsgYnViYmxlcyA9IGZhbHNlLCBjYW5jZWxhYmxlID0gZmFsc2UgfSkgewogICAgICAgIGNvbnN0IGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKTsKICAgICAgICBlLmluaXRDdXN0b21FdmVudCh0eXBlLCBidWJibGVzLCBjYW5jZWxhYmxlLCBkZXRhaWwpOwogICAgICAgIHJldHVybiBlOwogICAgfQoKICAgIGxldCBjdXJyZW50X2NvbXBvbmVudDsKICAgIGZ1bmN0aW9uIHNldF9jdXJyZW50X2NvbXBvbmVudChjb21wb25lbnQpIHsKICAgICAgICBjdXJyZW50X2NvbXBvbmVudCA9IGNvbXBvbmVudDsKICAgIH0KCiAgICBjb25zdCBkaXJ0eV9jb21wb25lbnRzID0gW107CiAgICBjb25zdCBiaW5kaW5nX2NhbGxiYWNrcyA9IFtdOwogICAgY29uc3QgcmVuZGVyX2NhbGxiYWNrcyA9IFtdOwogICAgY29uc3QgZmx1c2hfY2FsbGJhY2tzID0gW107CiAgICBjb25zdCByZXNvbHZlZF9wcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICBsZXQgdXBkYXRlX3NjaGVkdWxlZCA9IGZhbHNlOwogICAgZnVuY3Rpb24gc2NoZWR1bGVfdXBkYXRlKCkgewogICAgICAgIGlmICghdXBkYXRlX3NjaGVkdWxlZCkgewogICAgICAgICAgICB1cGRhdGVfc2NoZWR1bGVkID0gdHJ1ZTsKICAgICAgICAgICAgcmVzb2x2ZWRfcHJvbWlzZS50aGVuKGZsdXNoKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhZGRfcmVuZGVyX2NhbGxiYWNrKGZuKSB7CiAgICAgICAgcmVuZGVyX2NhbGxiYWNrcy5wdXNoKGZuKTsKICAgIH0KICAgIC8vIGZsdXNoKCkgY2FsbHMgY2FsbGJhY2tzIGluIHRoaXMgb3JkZXI6CiAgICAvLyAxLiBBbGwgYmVmb3JlVXBkYXRlIGNhbGxiYWNrcywgaW4gb3JkZXI6IHBhcmVudHMgYmVmb3JlIGNoaWxkcmVuCiAgICAvLyAyLiBBbGwgYmluZDp0aGlzIGNhbGxiYWNrcywgaW4gcmV2ZXJzZSBvcmRlcjogY2hpbGRyZW4gYmVmb3JlIHBhcmVudHMuCiAgICAvLyAzLiBBbGwgYWZ0ZXJVcGRhdGUgY2FsbGJhY2tzLCBpbiBvcmRlcjogcGFyZW50cyBiZWZvcmUgY2hpbGRyZW4uIEVYQ0VQVAogICAgLy8gICAgZm9yIGFmdGVyVXBkYXRlcyBjYWxsZWQgZHVyaW5nIHRoZSBpbml0aWFsIG9uTW91bnQsIHdoaWNoIGFyZSBjYWxsZWQgaW4KICAgIC8vICAgIHJldmVyc2Ugb3JkZXI6IGNoaWxkcmVuIGJlZm9yZSBwYXJlbnRzLgogICAgLy8gU2luY2UgY2FsbGJhY2tzIG1pZ2h0IHVwZGF0ZSBjb21wb25lbnQgdmFsdWVzLCB3aGljaCBjb3VsZCB0cmlnZ2VyIGFub3RoZXIKICAgIC8vIGNhbGwgdG8gZmx1c2goKSwgdGhlIGZvbGxvd2luZyBzdGVwcyBndWFyZCBhZ2FpbnN0IHRoaXM6CiAgICAvLyAxLiBEdXJpbmcgYmVmb3JlVXBkYXRlLCBhbnkgdXBkYXRlZCBjb21wb25lbnRzIHdpbGwgYmUgYWRkZWQgdG8gdGhlCiAgICAvLyAgICBkaXJ0eV9jb21wb25lbnRzIGFycmF5IGFuZCB3aWxsIGNhdXNlIGEgcmVlbnRyYW50IGNhbGwgdG8gZmx1c2goKS4gQmVjYXVzZQogICAgLy8gICAgdGhlIGZsdXNoIGluZGV4IGlzIGtlcHQgb3V0c2lkZSB0aGUgZnVuY3Rpb24sIHRoZSByZWVudHJhbnQgY2FsbCB3aWxsIHBpY2sKICAgIC8vICAgIHVwIHdoZXJlIHRoZSBlYXJsaWVyIGNhbGwgbGVmdCBvZmYgYW5kIGdvIHRocm91Z2ggYWxsIGRpcnR5IGNvbXBvbmVudHMuIFRoZQogICAgLy8gICAgY3VycmVudF9jb21wb25lbnQgdmFsdWUgaXMgc2F2ZWQgYW5kIHJlc3RvcmVkIHNvIHRoYXQgdGhlIHJlZW50cmFudCBjYWxsIHdpbGwKICAgIC8vICAgIG5vdCBpbnRlcmZlcmUgd2l0aCB0aGUgInBhcmVudCIgZmx1c2goKSBjYWxsLgogICAgLy8gMi4gYmluZDp0aGlzIGNhbGxiYWNrcyBjYW5ub3QgdHJpZ2dlciBuZXcgZmx1c2goKSBjYWxscy4KICAgIC8vIDMuIER1cmluZyBhZnRlclVwZGF0ZSwgYW55IHVwZGF0ZWQgY29tcG9uZW50cyB3aWxsIE5PVCBoYXZlIHRoZWlyIGFmdGVyVXBkYXRlCiAgICAvLyAgICBjYWxsYmFjayBjYWxsZWQgYSBzZWNvbmQgdGltZTsgdGhlIHNlZW5fY2FsbGJhY2tzIHNldCwgb3V0c2lkZSB0aGUgZmx1c2goKQogICAgLy8gICAgZnVuY3Rpb24sIGd1YXJhbnRlZXMgdGhpcyBiZWhhdmlvci4KICAgIGNvbnN0IHNlZW5fY2FsbGJhY2tzID0gbmV3IFNldCgpOwogICAgbGV0IGZsdXNoaWR4ID0gMDsgLy8gRG8gKm5vdCogbW92ZSB0aGlzIGluc2lkZSB0aGUgZmx1c2goKSBmdW5jdGlvbgogICAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgICAgY29uc3Qgc2F2ZWRfY29tcG9uZW50ID0gY3VycmVudF9jb21wb25lbnQ7CiAgICAgICAgZG8gewogICAgICAgICAgICAvLyBmaXJzdCwgY2FsbCBiZWZvcmVVcGRhdGUgZnVuY3Rpb25zCiAgICAgICAgICAgIC8vIGFuZCB1cGRhdGUgY29tcG9uZW50cwogICAgICAgICAgICB3aGlsZSAoZmx1c2hpZHggPCBkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gZGlydHlfY29tcG9uZW50c1tmbHVzaGlkeF07CiAgICAgICAgICAgICAgICBmbHVzaGlkeCsrOwogICAgICAgICAgICAgICAgc2V0X2N1cnJlbnRfY29tcG9uZW50KGNvbXBvbmVudCk7CiAgICAgICAgICAgICAgICB1cGRhdGUoY29tcG9uZW50LiQkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRfY3VycmVudF9jb21wb25lbnQobnVsbCk7CiAgICAgICAgICAgIGRpcnR5X2NvbXBvbmVudHMubGVuZ3RoID0gMDsKICAgICAgICAgICAgZmx1c2hpZHggPSAwOwogICAgICAgICAgICB3aGlsZSAoYmluZGluZ19jYWxsYmFja3MubGVuZ3RoKQogICAgICAgICAgICAgICAgYmluZGluZ19jYWxsYmFja3MucG9wKCkoKTsKICAgICAgICAgICAgLy8gdGhlbiwgb25jZSBjb21wb25lbnRzIGFyZSB1cGRhdGVkLCBjYWxsCiAgICAgICAgICAgIC8vIGFmdGVyVXBkYXRlIGZ1bmN0aW9ucy4gVGhpcyBtYXkgY2F1c2UKICAgICAgICAgICAgLy8gc3Vic2VxdWVudCB1cGRhdGVzLi4uCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVuZGVyX2NhbGxiYWNrcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSByZW5kZXJfY2FsbGJhY2tzW2ldOwogICAgICAgICAgICAgICAgaWYgKCFzZWVuX2NhbGxiYWNrcy5oYXMoY2FsbGJhY2spKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uc28gZ3VhcmQgYWdhaW5zdCBpbmZpbml0ZSBsb29wcwogICAgICAgICAgICAgICAgICAgIHNlZW5fY2FsbGJhY2tzLmFkZChjYWxsYmFjayk7CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJfY2FsbGJhY2tzLmxlbmd0aCA9IDA7CiAgICAgICAgfSB3aGlsZSAoZGlydHlfY29tcG9uZW50cy5sZW5ndGgpOwogICAgICAgIHdoaWxlIChmbHVzaF9jYWxsYmFja3MubGVuZ3RoKSB7CiAgICAgICAgICAgIGZsdXNoX2NhbGxiYWNrcy5wb3AoKSgpOwogICAgICAgIH0KICAgICAgICB1cGRhdGVfc2NoZWR1bGVkID0gZmFsc2U7CiAgICAgICAgc2Vlbl9jYWxsYmFja3MuY2xlYXIoKTsKICAgICAgICBzZXRfY3VycmVudF9jb21wb25lbnQoc2F2ZWRfY29tcG9uZW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZSgkJCkgewogICAgICAgIGlmICgkJC5mcmFnbWVudCAhPT0gbnVsbCkgewogICAgICAgICAgICAkJC51cGRhdGUoKTsKICAgICAgICAgICAgcnVuX2FsbCgkJC5iZWZvcmVfdXBkYXRlKTsKICAgICAgICAgICAgY29uc3QgZGlydHkgPSAkJC5kaXJ0eTsKICAgICAgICAgICAgJCQuZGlydHkgPSBbLTFdOwogICAgICAgICAgICAkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5wKCQkLmN0eCwgZGlydHkpOwogICAgICAgICAgICAkJC5hZnRlcl91cGRhdGUuZm9yRWFjaChhZGRfcmVuZGVyX2NhbGxiYWNrKTsKICAgICAgICB9CiAgICB9CiAgICBjb25zdCBvdXRyb2luZyA9IG5ldyBTZXQoKTsKICAgIGZ1bmN0aW9uIHRyYW5zaXRpb25faW4oYmxvY2ssIGxvY2FsKSB7CiAgICAgICAgaWYgKGJsb2NrICYmIGJsb2NrLmkpIHsKICAgICAgICAgICAgb3V0cm9pbmcuZGVsZXRlKGJsb2NrKTsKICAgICAgICAgICAgYmxvY2suaShsb2NhbCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gbW91bnRfY29tcG9uZW50KGNvbXBvbmVudCwgdGFyZ2V0LCBhbmNob3IsIGN1c3RvbUVsZW1lbnQpIHsKICAgICAgICBjb25zdCB7IGZyYWdtZW50LCBvbl9tb3VudCwgb25fZGVzdHJveSwgYWZ0ZXJfdXBkYXRlIH0gPSBjb21wb25lbnQuJCQ7CiAgICAgICAgZnJhZ21lbnQgJiYgZnJhZ21lbnQubSh0YXJnZXQsIGFuY2hvcik7CiAgICAgICAgaWYgKCFjdXN0b21FbGVtZW50KSB7CiAgICAgICAgICAgIC8vIG9uTW91bnQgaGFwcGVucyBiZWZvcmUgdGhlIGluaXRpYWwgYWZ0ZXJVcGRhdGUKICAgICAgICAgICAgYWRkX3JlbmRlcl9jYWxsYmFjaygoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdfb25fZGVzdHJveSA9IG9uX21vdW50Lm1hcChydW4pLmZpbHRlcihpc19mdW5jdGlvbik7CiAgICAgICAgICAgICAgICBpZiAob25fZGVzdHJveSkgewogICAgICAgICAgICAgICAgICAgIG9uX2Rlc3Ryb3kucHVzaCguLi5uZXdfb25fZGVzdHJveSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBFZGdlIGNhc2UgLSBjb21wb25lbnQgd2FzIGRlc3Ryb3llZCBpbW1lZGlhdGVseSwKICAgICAgICAgICAgICAgICAgICAvLyBtb3N0IGxpa2VseSBhcyBhIHJlc3VsdCBvZiBhIGJpbmRpbmcgaW5pdGlhbGlzaW5nCiAgICAgICAgICAgICAgICAgICAgcnVuX2FsbChuZXdfb25fZGVzdHJveSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb21wb25lbnQuJCQub25fbW91bnQgPSBbXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGFmdGVyX3VwZGF0ZS5mb3JFYWNoKGFkZF9yZW5kZXJfY2FsbGJhY2spOwogICAgfQogICAgZnVuY3Rpb24gZGVzdHJveV9jb21wb25lbnQoY29tcG9uZW50LCBkZXRhY2hpbmcpIHsKICAgICAgICBjb25zdCAkJCA9IGNvbXBvbmVudC4kJDsKICAgICAgICBpZiAoJCQuZnJhZ21lbnQgIT09IG51bGwpIHsKICAgICAgICAgICAgcnVuX2FsbCgkJC5vbl9kZXN0cm95KTsKICAgICAgICAgICAgJCQuZnJhZ21lbnQgJiYgJCQuZnJhZ21lbnQuZChkZXRhY2hpbmcpOwogICAgICAgICAgICAvLyBUT0RPIG51bGwgb3V0IG90aGVyIHJlZnMsIGluY2x1ZGluZyBjb21wb25lbnQuJCQgKGJ1dCBuZWVkIHRvCiAgICAgICAgICAgIC8vIHByZXNlcnZlIGZpbmFsIHN0YXRlPykKICAgICAgICAgICAgJCQub25fZGVzdHJveSA9ICQkLmZyYWdtZW50ID0gbnVsbDsKICAgICAgICAgICAgJCQuY3R4ID0gW107CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gbWFrZV9kaXJ0eShjb21wb25lbnQsIGkpIHsKICAgICAgICBpZiAoY29tcG9uZW50LiQkLmRpcnR5WzBdID09PSAtMSkgewogICAgICAgICAgICBkaXJ0eV9jb21wb25lbnRzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgc2NoZWR1bGVfdXBkYXRlKCk7CiAgICAgICAgICAgIGNvbXBvbmVudC4kJC5kaXJ0eS5maWxsKDApOwogICAgICAgIH0KICAgICAgICBjb21wb25lbnQuJCQuZGlydHlbKGkgLyAzMSkgfCAwXSB8PSAoMSA8PCAoaSAlIDMxKSk7CiAgICB9CiAgICBmdW5jdGlvbiBpbml0KGNvbXBvbmVudCwgb3B0aW9ucywgaW5zdGFuY2UsIGNyZWF0ZV9mcmFnbWVudCwgbm90X2VxdWFsLCBwcm9wcywgYXBwZW5kX3N0eWxlcywgZGlydHkgPSBbLTFdKSB7CiAgICAgICAgY29uc3QgcGFyZW50X2NvbXBvbmVudCA9IGN1cnJlbnRfY29tcG9uZW50OwogICAgICAgIHNldF9jdXJyZW50X2NvbXBvbmVudChjb21wb25lbnQpOwogICAgICAgIGNvbnN0ICQkID0gY29tcG9uZW50LiQkID0gewogICAgICAgICAgICBmcmFnbWVudDogbnVsbCwKICAgICAgICAgICAgY3R4OiBudWxsLAogICAgICAgICAgICAvLyBzdGF0ZQogICAgICAgICAgICBwcm9wcywKICAgICAgICAgICAgdXBkYXRlOiBub29wLAogICAgICAgICAgICBub3RfZXF1YWwsCiAgICAgICAgICAgIGJvdW5kOiBibGFua19vYmplY3QoKSwKICAgICAgICAgICAgLy8gbGlmZWN5Y2xlCiAgICAgICAgICAgIG9uX21vdW50OiBbXSwKICAgICAgICAgICAgb25fZGVzdHJveTogW10sCiAgICAgICAgICAgIG9uX2Rpc2Nvbm5lY3Q6IFtdLAogICAgICAgICAgICBiZWZvcmVfdXBkYXRlOiBbXSwKICAgICAgICAgICAgYWZ0ZXJfdXBkYXRlOiBbXSwKICAgICAgICAgICAgY29udGV4dDogbmV3IE1hcChvcHRpb25zLmNvbnRleHQgfHwgKHBhcmVudF9jb21wb25lbnQgPyBwYXJlbnRfY29tcG9uZW50LiQkLmNvbnRleHQgOiBbXSkpLAogICAgICAgICAgICAvLyBldmVyeXRoaW5nIGVsc2UKICAgICAgICAgICAgY2FsbGJhY2tzOiBibGFua19vYmplY3QoKSwKICAgICAgICAgICAgZGlydHksCiAgICAgICAgICAgIHNraXBfYm91bmQ6IGZhbHNlLAogICAgICAgICAgICByb290OiBvcHRpb25zLnRhcmdldCB8fCBwYXJlbnRfY29tcG9uZW50LiQkLnJvb3QKICAgICAgICB9OwogICAgICAgIGFwcGVuZF9zdHlsZXMgJiYgYXBwZW5kX3N0eWxlcygkJC5yb290KTsKICAgICAgICBsZXQgcmVhZHkgPSBmYWxzZTsKICAgICAgICAkJC5jdHggPSBpbnN0YW5jZQogICAgICAgICAgICA/IGluc3RhbmNlKGNvbXBvbmVudCwgb3B0aW9ucy5wcm9wcyB8fCB7fSwgKGksIHJldCwgLi4ucmVzdCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSByZXN0Lmxlbmd0aCA/IHJlc3RbMF0gOiByZXQ7CiAgICAgICAgICAgICAgICBpZiAoJCQuY3R4ICYmIG5vdF9lcXVhbCgkJC5jdHhbaV0sICQkLmN0eFtpXSA9IHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlmICghJCQuc2tpcF9ib3VuZCAmJiAkJC5ib3VuZFtpXSkKICAgICAgICAgICAgICAgICAgICAgICAgJCQuYm91bmRbaV0odmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWFkeSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFrZV9kaXJ0eShjb21wb25lbnQsIGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgOiBbXTsKICAgICAgICAkJC51cGRhdGUoKTsKICAgICAgICByZWFkeSA9IHRydWU7CiAgICAgICAgcnVuX2FsbCgkJC5iZWZvcmVfdXBkYXRlKTsKICAgICAgICAvLyBgZmFsc2VgIGFzIGEgc3BlY2lhbCBjYXNlIG9mIG5vIERPTSBjb21wb25lbnQKICAgICAgICAkJC5mcmFnbWVudCA9IGNyZWF0ZV9mcmFnbWVudCA/IGNyZWF0ZV9mcmFnbWVudCgkJC5jdHgpIDogZmFsc2U7CiAgICAgICAgaWYgKG9wdGlvbnMudGFyZ2V0KSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmh5ZHJhdGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gY2hpbGRyZW4ob3B0aW9ucy50YXJnZXQpOwogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24KICAgICAgICAgICAgICAgICQkLmZyYWdtZW50ICYmICQkLmZyYWdtZW50Lmwobm9kZXMpOwogICAgICAgICAgICAgICAgbm9kZXMuZm9yRWFjaChkZXRhY2gpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24KICAgICAgICAgICAgICAgICQkLmZyYWdtZW50ICYmICQkLmZyYWdtZW50LmMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5pbnRybykKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25faW4oY29tcG9uZW50LiQkLmZyYWdtZW50KTsKICAgICAgICAgICAgbW91bnRfY29tcG9uZW50KGNvbXBvbmVudCwgb3B0aW9ucy50YXJnZXQsIG9wdGlvbnMuYW5jaG9yLCBvcHRpb25zLmN1c3RvbUVsZW1lbnQpOwogICAgICAgICAgICBmbHVzaCgpOwogICAgICAgIH0KICAgICAgICBzZXRfY3VycmVudF9jb21wb25lbnQocGFyZW50X2NvbXBvbmVudCk7CiAgICB9CiAgICAvKioKICAgICAqIEJhc2UgY2xhc3MgZm9yIFN2ZWx0ZSBjb21wb25lbnRzLiBVc2VkIHdoZW4gZGV2PWZhbHNlLgogICAgICovCiAgICBjbGFzcyBTdmVsdGVDb21wb25lbnQgewogICAgICAgICRkZXN0cm95KCkgewogICAgICAgICAgICBkZXN0cm95X2NvbXBvbmVudCh0aGlzLCAxKTsKICAgICAgICAgICAgdGhpcy4kZGVzdHJveSA9IG5vb3A7CiAgICAgICAgfQogICAgICAgICRvbih0eXBlLCBjYWxsYmFjaykgewogICAgICAgICAgICBjb25zdCBjYWxsYmFja3MgPSAodGhpcy4kJC5jYWxsYmFja3NbdHlwZV0gfHwgKHRoaXMuJCQuY2FsbGJhY2tzW3R5cGVdID0gW10pKTsKICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjYWxsYmFja3MuaW5kZXhPZihjYWxsYmFjayk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICAkc2V0KCQkcHJvcHMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJCRzZXQgJiYgIWlzX2VtcHR5KCQkcHJvcHMpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiQkLnNraXBfYm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy4kJHNldCgkJHByb3BzKTsKICAgICAgICAgICAgICAgIHRoaXMuJCQuc2tpcF9ib3VuZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpc3BhdGNoX2Rldih0eXBlLCBkZXRhaWwpIHsKICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGN1c3RvbV9ldmVudCh0eXBlLCBPYmplY3QuYXNzaWduKHsgdmVyc2lvbjogJzMuNDguMCcgfSwgZGV0YWlsKSwgeyBidWJibGVzOiB0cnVlIH0pKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcGVuZF9kZXYodGFyZ2V0LCBub2RlKSB7CiAgICAgICAgZGlzcGF0Y2hfZGV2KCdTdmVsdGVET01JbnNlcnQnLCB7IHRhcmdldCwgbm9kZSB9KTsKICAgICAgICBhcHBlbmQodGFyZ2V0LCBub2RlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGluc2VydF9kZXYodGFyZ2V0LCBub2RlLCBhbmNob3IpIHsKICAgICAgICBkaXNwYXRjaF9kZXYoJ1N2ZWx0ZURPTUluc2VydCcsIHsgdGFyZ2V0LCBub2RlLCBhbmNob3IgfSk7CiAgICAgICAgaW5zZXJ0KHRhcmdldCwgbm9kZSwgYW5jaG9yKTsKICAgIH0KICAgIGZ1bmN0aW9uIGRldGFjaF9kZXYobm9kZSkgewogICAgICAgIGRpc3BhdGNoX2RldignU3ZlbHRlRE9NUmVtb3ZlJywgeyBub2RlIH0pOwogICAgICAgIGRldGFjaChub2RlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldF9kYXRhX2Rldih0ZXh0LCBkYXRhKSB7CiAgICAgICAgZGF0YSA9ICcnICsgZGF0YTsKICAgICAgICBpZiAodGV4dC53aG9sZVRleHQgPT09IGRhdGEpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBkaXNwYXRjaF9kZXYoJ1N2ZWx0ZURPTVNldERhdGEnLCB7IG5vZGU6IHRleHQsIGRhdGEgfSk7CiAgICAgICAgdGV4dC5kYXRhID0gZGF0YTsKICAgIH0KICAgIGZ1bmN0aW9uIHZhbGlkYXRlX3Nsb3RzKG5hbWUsIHNsb3QsIGtleXMpIHsKICAgICAgICBmb3IgKGNvbnN0IHNsb3Rfa2V5IG9mIE9iamVjdC5rZXlzKHNsb3QpKSB7CiAgICAgICAgICAgIGlmICghfmtleXMuaW5kZXhPZihzbG90X2tleSkpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgPCR7bmFtZX0+IHJlY2VpdmVkIGFuIHVuZXhwZWN0ZWQgc2xvdCAiJHtzbG90X2tleX0iLmApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBCYXNlIGNsYXNzIGZvciBTdmVsdGUgY29tcG9uZW50cyB3aXRoIHNvbWUgbWlub3IgZGV2LWVuaGFuY2VtZW50cy4gVXNlZCB3aGVuIGRldj10cnVlLgogICAgICovCiAgICBjbGFzcyBTdmVsdGVDb21wb25lbnREZXYgZXh0ZW5kcyBTdmVsdGVDb21wb25lbnQgewogICAgICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKCFvcHRpb25zIHx8ICghb3B0aW9ucy50YXJnZXQgJiYgIW9wdGlvbnMuJCRpbmxpbmUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIid0YXJnZXQnIGlzIGEgcmVxdWlyZWQgb3B0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICB9CiAgICAgICAgJGRlc3Ryb3koKSB7CiAgICAgICAgICAgIHN1cGVyLiRkZXN0cm95KCk7CiAgICAgICAgICAgIHRoaXMuJGRlc3Ryb3kgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvbXBvbmVudCB3YXMgYWxyZWFkeSBkZXN0cm95ZWQnKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgICRjYXB0dXJlX3N0YXRlKCkgeyB9CiAgICAgICAgJGluamVjdF9zdGF0ZSgpIHsgfQogICAgfQoKICAgIC8qIHNyY1xBcHAuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjMuNDguMCAqLwoKICAgIGNvbnN0IGZpbGUgPSAic3JjXFxBcHAuc3ZlbHRlIjsKCiAgICBmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQoY3R4KSB7CiAgICAJbGV0IGRpdjsKICAgIAlsZXQgcDA7CiAgICAJbGV0IHQwOwogICAgCWxldCB0MTsKICAgIAlsZXQgdDI7CiAgICAJbGV0IHAxOwogICAgCWxldCB0MzsKICAgIAlsZXQgdDQ7CiAgICAJbGV0IHQ1OwogICAgCWxldCBoMTsKICAgIAlsZXQgdDY7CiAgICAJbGV0IHQ3OwogICAgCWxldCB0ODsKICAgIAlsZXQgZGl2X3Jlc2l6ZV9saXN0ZW5lcjsKCiAgICAJY29uc3QgYmxvY2sgPSB7CiAgICAJCWM6IGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgIAkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwogICAgCQkJcDAgPSBlbGVtZW50KCJwIik7CiAgICAJCQl0MCA9IHRleHQoIldpZHRoOiAiKTsKICAgIAkJCXQxID0gdGV4dCgvKm9mZnNldFdpZHRoKi8gY3R4WzBdKTsKICAgIAkJCXQyID0gc3BhY2UoKTsKICAgIAkJCXAxID0gZWxlbWVudCgicCIpOwogICAgCQkJdDMgPSB0ZXh0KCJIZWlnaHQ6ICIpOwogICAgCQkJdDQgPSB0ZXh0KC8qb2Zmc2V0SGVpZ2h0Ki8gY3R4WzFdKTsKICAgIAkJCXQ1ID0gdGV4dCgiXG4gICAgSGV5eXlcbiAgICAiKTsKICAgIAkJCWgxID0gZWxlbWVudCgiaDEiKTsKICAgIAkJCXQ2ID0gdGV4dCgiSGVsbG8gIik7CiAgICAJCQl0NyA9IHRleHQoLypuYW1lKi8gY3R4WzJdKTsKICAgIAkJCXQ4ID0gdGV4dCgiISIpOwogICAgCQkJYWRkX2xvY2F0aW9uKHAwLCBmaWxlLCAxMywgNCwgMjcyKTsKICAgIAkJCWFkZF9sb2NhdGlvbihwMSwgZmlsZSwgMTQsIDQsIDMwNCk7CiAgICAJCQlhZGRfbG9jYXRpb24oaDEsIGZpbGUsIDE2LCA0LCAzNDgpOwogICAgCQkJYWRkX3JlbmRlcl9jYWxsYmFjaygoKSA9PiAvKmRpdl9lbGVtZW50cmVzaXplX2hhbmRsZXIqLyBjdHhbM10uY2FsbChkaXYpKTsKICAgIAkJCWFkZF9sb2NhdGlvbihkaXYsIGZpbGUsIDEyLCAwLCAyMjcpOwogICAgCQl9LAogICAgCQlsOiBmdW5jdGlvbiBjbGFpbShub2RlcykgewogICAgCQkJdGhyb3cgbmV3IEVycm9yKCJvcHRpb25zLmh5ZHJhdGUgb25seSB3b3JrcyBpZiB0aGUgY29tcG9uZW50IHdhcyBjb21waWxlZCB3aXRoIHRoZSBgaHlkcmF0YWJsZTogdHJ1ZWAgb3B0aW9uIik7CiAgICAJCX0sCiAgICAJCW06IGZ1bmN0aW9uIG1vdW50KHRhcmdldCwgYW5jaG9yKSB7CiAgICAJCQlpbnNlcnRfZGV2KHRhcmdldCwgZGl2LCBhbmNob3IpOwogICAgCQkJYXBwZW5kX2RldihkaXYsIHAwKTsKICAgIAkJCWFwcGVuZF9kZXYocDAsIHQwKTsKICAgIAkJCWFwcGVuZF9kZXYocDAsIHQxKTsKICAgIAkJCWFwcGVuZF9kZXYoZGl2LCB0Mik7CiAgICAJCQlhcHBlbmRfZGV2KGRpdiwgcDEpOwogICAgCQkJYXBwZW5kX2RldihwMSwgdDMpOwogICAgCQkJYXBwZW5kX2RldihwMSwgdDQpOwogICAgCQkJYXBwZW5kX2RldihkaXYsIHQ1KTsKICAgIAkJCWFwcGVuZF9kZXYoZGl2LCBoMSk7CiAgICAJCQlhcHBlbmRfZGV2KGgxLCB0Nik7CiAgICAJCQlhcHBlbmRfZGV2KGgxLCB0Nyk7CiAgICAJCQlhcHBlbmRfZGV2KGgxLCB0OCk7CiAgICAJCQlkaXZfcmVzaXplX2xpc3RlbmVyID0gYWRkX3Jlc2l6ZV9saXN0ZW5lcihkaXYsIC8qZGl2X2VsZW1lbnRyZXNpemVfaGFuZGxlciovIGN0eFszXS5iaW5kKGRpdikpOwogICAgCQl9LAogICAgCQlwOiBmdW5jdGlvbiB1cGRhdGUoY3R4LCBbZGlydHldKSB7CiAgICAJCQlpZiAoZGlydHkgJiAvKm9mZnNldFdpZHRoKi8gMSkgc2V0X2RhdGFfZGV2KHQxLCAvKm9mZnNldFdpZHRoKi8gY3R4WzBdKTsKICAgIAkJCWlmIChkaXJ0eSAmIC8qb2Zmc2V0SGVpZ2h0Ki8gMikgc2V0X2RhdGFfZGV2KHQ0LCAvKm9mZnNldEhlaWdodCovIGN0eFsxXSk7CiAgICAJCQlpZiAoZGlydHkgJiAvKm5hbWUqLyA0KSBzZXRfZGF0YV9kZXYodDcsIC8qbmFtZSovIGN0eFsyXSk7CiAgICAJCX0sCiAgICAJCWk6IG5vb3AsCiAgICAJCW86IG5vb3AsCiAgICAJCWQ6IGZ1bmN0aW9uIGRlc3Ryb3koZGV0YWNoaW5nKSB7CiAgICAJCQlpZiAoZGV0YWNoaW5nKSBkZXRhY2hfZGV2KGRpdik7CiAgICAJCQlkaXZfcmVzaXplX2xpc3RlbmVyKCk7CiAgICAJCX0KICAgIAl9OwoKICAgIAlkaXNwYXRjaF9kZXYoIlN2ZWx0ZVJlZ2lzdGVyQmxvY2siLCB7CiAgICAJCWJsb2NrLAogICAgCQlpZDogY3JlYXRlX2ZyYWdtZW50Lm5hbWUsCiAgICAJCXR5cGU6ICJjb21wb25lbnQiLAogICAgCQlzb3VyY2U6ICIiLAogICAgCQljdHgKICAgIAl9KTsKCiAgICAJcmV0dXJuIGJsb2NrOwogICAgfQoKICAgIGZ1bmN0aW9uIGluc3RhbmNlKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CiAgICAJbGV0IHsgJCRzbG90czogc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wczsKICAgIAl2YWxpZGF0ZV9zbG90cygnQXBwJywgc2xvdHMsIFtdKTsKICAgIAlsZXQgeyBuYW1lID0gIkRvdWciIH0gPSAkJHByb3BzOwogICAgCWxldCB7IG9mZnNldFdpZHRoIH0gPSAkJHByb3BzOwogICAgCWxldCB7IG9mZnNldEhlaWdodCB9ID0gJCRwcm9wczsKICAgIAljb25zdCB3cml0YWJsZV9wcm9wcyA9IFsnbmFtZScsICdvZmZzZXRXaWR0aCcsICdvZmZzZXRIZWlnaHQnXTsKCiAgICAJT2JqZWN0LmtleXMoJCRwcm9wcykuZm9yRWFjaChrZXkgPT4gewogICAgCQlpZiAoIX53cml0YWJsZV9wcm9wcy5pbmRleE9mKGtleSkgJiYga2V5LnNsaWNlKDAsIDIpICE9PSAnJCQnICYmIGtleSAhPT0gJ3Nsb3QnKSBjb25zb2xlLndhcm4oYDxBcHA+IHdhcyBjcmVhdGVkIHdpdGggdW5rbm93biBwcm9wICcke2tleX0nYCk7CiAgICAJfSk7CgogICAgCWZ1bmN0aW9uIGRpdl9lbGVtZW50cmVzaXplX2hhbmRsZXIoKSB7CiAgICAJCW9mZnNldFdpZHRoID0gdGhpcy5vZmZzZXRXaWR0aDsKICAgIAkJb2Zmc2V0SGVpZ2h0ID0gdGhpcy5vZmZzZXRIZWlnaHQ7CiAgICAJCSQkaW52YWxpZGF0ZSgwLCBvZmZzZXRXaWR0aCk7CiAgICAJCSQkaW52YWxpZGF0ZSgxLCBvZmZzZXRIZWlnaHQpOwogICAgCX0KCiAgICAJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CiAgICAJCWlmICgnbmFtZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDIsIG5hbWUgPSAkJHByb3BzLm5hbWUpOwogICAgCQlpZiAoJ29mZnNldFdpZHRoJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgb2Zmc2V0V2lkdGggPSAkJHByb3BzLm9mZnNldFdpZHRoKTsKICAgIAkJaWYgKCdvZmZzZXRIZWlnaHQnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBvZmZzZXRIZWlnaHQgPSAkJHByb3BzLm9mZnNldEhlaWdodCk7CiAgICAJfTsKCiAgICAJJCRzZWxmLiRjYXB0dXJlX3N0YXRlID0gKCkgPT4gKHsgbmFtZSwgb2Zmc2V0V2lkdGgsIG9mZnNldEhlaWdodCB9KTsKCiAgICAJJCRzZWxmLiRpbmplY3Rfc3RhdGUgPSAkJHByb3BzID0+IHsKICAgIAkJaWYgKCduYW1lJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMiwgbmFtZSA9ICQkcHJvcHMubmFtZSk7CiAgICAJCWlmICgnb2Zmc2V0V2lkdGgnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgwLCBvZmZzZXRXaWR0aCA9ICQkcHJvcHMub2Zmc2V0V2lkdGgpOwogICAgCQlpZiAoJ29mZnNldEhlaWdodCcgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIG9mZnNldEhlaWdodCA9ICQkcHJvcHMub2Zmc2V0SGVpZ2h0KTsKICAgIAl9OwoKICAgIAlpZiAoJCRwcm9wcyAmJiAiJCRpbmplY3QiIGluICQkcHJvcHMpIHsKICAgIAkJJCRzZWxmLiRpbmplY3Rfc3RhdGUoJCRwcm9wcy4kJGluamVjdCk7CiAgICAJfQoKICAgIAlyZXR1cm4gW29mZnNldFdpZHRoLCBvZmZzZXRIZWlnaHQsIG5hbWUsIGRpdl9lbGVtZW50cmVzaXplX2hhbmRsZXJdOwogICAgfQoKICAgIGNsYXNzIEFwcCBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudERldiB7CiAgICAJY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgCQlzdXBlcihvcHRpb25zKTsKICAgIAkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSwgY3JlYXRlX2ZyYWdtZW50LCBzYWZlX25vdF9lcXVhbCwgeyBuYW1lOiAyLCBvZmZzZXRXaWR0aDogMCwgb2Zmc2V0SGVpZ2h0OiAxIH0pOwoKICAgIAkJZGlzcGF0Y2hfZGV2KCJTdmVsdGVSZWdpc3RlckNvbXBvbmVudCIsIHsKICAgIAkJCWNvbXBvbmVudDogdGhpcywKICAgIAkJCXRhZ05hbWU6ICJBcHAiLAogICAgCQkJb3B0aW9ucywKICAgIAkJCWlkOiBjcmVhdGVfZnJhZ21lbnQubmFtZQogICAgCQl9KTsKCiAgICAJCWNvbnN0IHsgY3R4IH0gPSB0aGlzLiQkOwogICAgCQljb25zdCBwcm9wcyA9IG9wdGlvbnMucHJvcHMgfHwge307CgogICAgCQlpZiAoLypvZmZzZXRXaWR0aCovIGN0eFswXSA9PT0gdW5kZWZpbmVkICYmICEoJ29mZnNldFdpZHRoJyBpbiBwcm9wcykpIHsKICAgIAkJCWNvbnNvbGUud2FybigiPEFwcD4gd2FzIGNyZWF0ZWQgd2l0aG91dCBleHBlY3RlZCBwcm9wICdvZmZzZXRXaWR0aCciKTsKICAgIAkJfQoKICAgIAkJaWYgKC8qb2Zmc2V0SGVpZ2h0Ki8gY3R4WzFdID09PSB1bmRlZmluZWQgJiYgISgnb2Zmc2V0SGVpZ2h0JyBpbiBwcm9wcykpIHsKICAgIAkJCWNvbnNvbGUud2FybigiPEFwcD4gd2FzIGNyZWF0ZWQgd2l0aG91dCBleHBlY3RlZCBwcm9wICdvZmZzZXRIZWlnaHQnIik7CiAgICAJCX0KICAgIAl9CgogICAgCWdldCBuYW1lKCkgewogICAgCQl0aHJvdyBuZXcgRXJyb3IoIjxBcHA+OiBQcm9wcyBjYW5ub3QgYmUgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdW5sZXNzIGNvbXBpbGluZyB3aXRoICdhY2Nlc3NvcnM6IHRydWUnIG9yICc8c3ZlbHRlOm9wdGlvbnMgYWNjZXNzb3JzLz4nIik7CiAgICAJfQoKICAgIAlzZXQgbmFtZSh2YWx1ZSkgewogICAgCQl0aHJvdyBuZXcgRXJyb3IoIjxBcHA+OiBQcm9wcyBjYW5ub3QgYmUgc2V0IGRpcmVjdGx5IG9uIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdW5sZXNzIGNvbXBpbGluZyB3aXRoICdhY2Nlc3NvcnM6IHRydWUnIG9yICc8c3ZlbHRlOm9wdGlvbnMgYWNjZXNzb3JzLz4nIik7CiAgICAJfQoKICAgIAlnZXQgb2Zmc2V0V2lkdGgoKSB7CiAgICAJCXRocm93IG5ldyBFcnJvcigiPEFwcD46IFByb3BzIGNhbm5vdCBiZSByZWFkIGRpcmVjdGx5IGZyb20gdGhlIGNvbXBvbmVudCBpbnN0YW5jZSB1bmxlc3MgY29tcGlsaW5nIHdpdGggJ2FjY2Vzc29yczogdHJ1ZScgb3IgJzxzdmVsdGU6b3B0aW9ucyBhY2Nlc3NvcnMvPiciKTsKICAgIAl9CgogICAgCXNldCBvZmZzZXRXaWR0aCh2YWx1ZSkgewogICAgCQl0aHJvdyBuZXcgRXJyb3IoIjxBcHA+OiBQcm9wcyBjYW5ub3QgYmUgc2V0IGRpcmVjdGx5IG9uIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdW5sZXNzIGNvbXBpbGluZyB3aXRoICdhY2Nlc3NvcnM6IHRydWUnIG9yICc8c3ZlbHRlOm9wdGlvbnMgYWNjZXNzb3JzLz4nIik7CiAgICAJfQoKICAgIAlnZXQgb2Zmc2V0SGVpZ2h0KCkgewogICAgCQl0aHJvdyBuZXcgRXJyb3IoIjxBcHA+OiBQcm9wcyBjYW5ub3QgYmUgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdW5sZXNzIGNvbXBpbGluZyB3aXRoICdhY2Nlc3NvcnM6IHRydWUnIG9yICc8c3ZlbHRlOm9wdGlvbnMgYWNjZXNzb3JzLz4nIik7CiAgICAJfQoKICAgIAlzZXQgb2Zmc2V0SGVpZ2h0KHZhbHVlKSB7CiAgICAJCXRocm93IG5ldyBFcnJvcigiPEFwcD46IFByb3BzIGNhbm5vdCBiZSBzZXQgZGlyZWN0bHkgb24gdGhlIGNvbXBvbmVudCBpbnN0YW5jZSB1bmxlc3MgY29tcGlsaW5nIHdpdGggJ2FjY2Vzc29yczogdHJ1ZScgb3IgJzxzdmVsdGU6b3B0aW9ucyBhY2Nlc3NvcnMvPiciKTsKICAgIAl9CiAgICB9CgogICAgY29uc3QgYXBwID0gbmV3IEFwcCh7CiAgICAgICAgdGFyZ2V0OiBkb2N1bWVudC5ib2R5LAogICAgICAgIHByb3BzOiB7CiAgICAgICAgICAgIC8vIG5hbWU6ICd3b3JsZCcKICAgICAgICB9LAogICAgfSk7CgogICAgcmV0dXJuIGFwcDsKCn0pKCk7Cg==
        </script>

        <script defer type="module">
            // load the base64 script from docuemnt getelementbyid data
            const src64 = document.getElementById("svelte64").textContent

            // load code from base64 into the DOM
            const script = document.createElement("script")
            script.textContent = atob(src64)
            document.head.appendChild(script)
        </script>
    </head>

    <body></body>
</html>
